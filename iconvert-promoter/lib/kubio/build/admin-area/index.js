(()=>{"use strict";var t={d:(a,i)=>{for(var e in i)t.o(i,e)&&!t.o(a,e)&&Object.defineProperty(a,e,{enumerable:!0,get:i[e]})},o:(t,a)=>Object.prototype.hasOwnProperty.call(t,a),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},a={};t.r(a),t.d(a,{initDemoImport:()=>A});const i=window.lodash;let e={},o={};const s="NOT_INSTALLED",n=t=>e=t,r=()=>{var t;return(null===(t=o)||void 0===t?void 0:t.plugins)||[]},l=()=>e.ajax_nonce,d=()=>e.ajax_url,c=t=>{var a;return(null===(a=e.texts)||void 0===a?void 0:a[t])||""},p=t=>e.plugins_states[t]||s,u=window.jQuery,m=window.wp.i18n,g=window.wp.url,h=t=>new Promise(((a,e)=>{const o=t instanceof window.FormData?t:new window.FormData;o.append("nonce",l()),(0,i.each)(t,((t,a)=>o.append(a,t))),u.ajax({method:"POST",url:(0,g.addQueryArgs)(d(),{nonce:l(),action:o.get("action")}),data:o,contentType:!1,processData:!1}).done((t=>{if(!1===t.success){var i,o;const a=(null==t||null===(i=t.data)||void 0===i?void 0:i.error_message)||(null==t||null===(o=t.data)||void 0===o?void 0:o.error);e(a)}else a(t)})).fail((t=>{e(`${t.status} ( ${t.statusText} ) : ${t.responseText}`)}))})),b=window.kubio.constants,w=async t=>await h({action:(0,b.getKubioUrlWithRestPrefix)("kubio-demo-site-activate-plugin"),slug:t}),f=async t=>{const a=p(t);try{switch(a){case"ACTIVE":return!0;case"INSTALLED":await w(t);break;case s:await(async t=>await h({action:(0,b.getKubioUrlWithRestPrefix)("kubio-demo-site-install-plugin"),slug:t}))(t),await w(t)}}catch(t){throw t}},y=async(t=null)=>{let a={action:(0,b.getKubioUrlWithRestPrefix)("kubio-demo-site-import-data"),slug:o.slug||0,first_call:!0};try{let e={};do{if(t&&a.first_call?((0,i.each)(a,((a,i)=>t.append(i,a))),e=await h(t)):e=await h(a),a=(0,i.omit)(a,"first_call"),e.before_import_action?(T(E.PREPARING,S.PROGRESS),a={...a,before_import_action:e.before_import_action}):(T(E.PREPARING,S.DONE),T(E.CONTENT,S.PROGRESS),a=(0,i.omit)(a,"before_import_action")),"finished"===e.status){T(E.CONTENT,S.DONE);break}}while("requires-new-ajax-call"===e.status)}catch(t){I(t)}};let k=0;const v=(t=!0)=>{const a=u("#kubio-templates-list"),i=u("#kubio-template-installing");if(t){k=window.scrollY,a.hide(),i.css("display","flex").hide().fadeIn(100),i.find("img").attr("src",o.thumb);const t=(0,m.sprintf)(c("importing_template"),o.name);i.find("[data-title]").html(t);const s=r(),n=i.find("[data-plugins]"),l=i.find("[data-plugins-list]");s.length?(n.show(),l.empty(),s.forEach((t=>{const a=(i=t.slug,e.texts.plugins_states[p(i)]);var i;l.append(`<li><span>${t.label}</span><span>${a}</span></li>`)}))):n.hide();const d=!o.is_pro;(t=>{const a=u("#kubio-template-installing"),i=a.find("#import-button"),e=a.find("[data-available-pro-only]"),o=a.find("[data-check-pro-features]");t?(e.addClass("hidden"),o.addClass("hidden"),i.attr("data-start-import",""),i.show()):(i.removeAttr("data-start-import"),i.hide(),e.removeClass("hidden"),o.removeClass("hidden"))})(!(!e.kubio_pro_active&&!d))}else i.css("display","flex").hide(),u("#kubio-templates-list").show(),setTimeout((()=>window.scrollTo(0,k)),5)},_=async()=>{u(".kubio-admin-page-header-start-editing").addClass("hidden");const t=u("#kubio-template-installing"),a=t.find("[data-info]"),i=t.find("[data-progress]"),e=t.find("[data-install-buttons]"),o=t.find("[data-install-success-buttons]"),s=u(".kubio-progress-bar");a.hide(),i.css("display","flex").show(),e.hide(),s.show();try{await(async()=>{try{T(E.PLUGINS,S.PROGRESS);const t=r();for(let a=0;a<t.length;a++){const{slug:i}=t[a];await f(i)}T(E.PLUGINS,S.DONE)}catch(t){I(t)}})(),await y()}catch(t){I()}s.hide(),o.show(),u(".kubio-admin-page-header-start-editing").removeClass("hidden")},P=()=>{u((()=>{u(document).on("click","#kubio-templates-list button[data-slug]",(function(){(t=>{const a=(0,i.find)(e.demos,{slug:t});o=a})(u(this).data("slug")),v()})),u(document).on("click","#kubio-template-installing button[data-cancel-import]",(function(){v(!1)})),u(document).on("click","#kubio-template-installing button[data-start-import]",_),u(document).on("submit","#kubio-import-demo-site",(async t=>{t.preventDefault(),t.stopPropagation();const a=t.target,i=new window.FormData(a);O=!0;const e=u(a).siblings(".kubio-progress-bar");e.show(),u(a).hide();try{await y(i)}catch(t){e.hide();const a=R(t);u("[data-kubio-manual-demo-site-errors]").append(`<div class="kubio-demo-site-manual-import-error">${a}</div>`)}e.hide()}))}))},E={PLUGINS:"plugins",PREPARING:"preparing",CONTENT:"content"},N={plugins:"data-installing-plugins",preparing:"data-preparing-for-import",content:"data-importing-content"},S={INACTIVE:"",PROGRESS:"progress",DONE:"active"},T=(t,a)=>{u(`[data-progress-list] [${N[t]}]`).attr("class",a)};let O=!1;const R=t=>{t=(0,i.castArray)(t);let a="";return t.forEach((t=>a+=`<p>${t}</p>`)),a},x=t=>{if(O)return;const a="[data-importing-errors]";u(a).show(),(t=(0,i.castArray)(t)).forEach((t=>u(`${a} [data-importing-errors-content]`).append(`<p>${t}</p>`)))},I=t=>{throw O||(x(t),x(c("import_stopped")),O=!0),u(".kubio-progress-bar").hide(),u("[data-progress-list] li").attr("class",""),t},A=t=>{n(t),P()};(window.kubio=window.kubio||{}).adminArea=a})();
