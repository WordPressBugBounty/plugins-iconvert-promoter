(()=>{"use strict";var e={n:t=>{var o=t&&t.__esModule?()=>t.default:()=>t;return e.d(o,{a:o}),o},d:(t,o)=>{for(var n in o)e.o(o,n)&&!e.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:o[n]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};e.r(t),e.d(t,{initFirebaseData:()=>$,initializeGutentagPatterns:()=>h,registerPattern:()=>g,registerPatternCategory:()=>w});const o=window.kubio.constants,n=window.kubio.utils,i=window.wp.data,r=window.wp.hooks,s=window.lodash;var a=e.n(s);window.wp.apiFetch,window.wp.url;let l=null,c=null;const u="__experimentalBlockPatterns",d="__experimentalBlockPatternCategories";let b=[],f=[];const p=e=>(0,s.omit)(e,"kubio.styleRef"),k=e=>e.map((([e,t,o])=>[e,p(t),k(o)])),m=(e,t)=>{t=(e=>({...e,attributes:p(e.attributes),innerBlocks:k(e.innerBlocks)}))(t);const o=(0,i.select)("core/blocks").getBlockType(e),s=(null==o?void 0:o.variationsFilter)||a().identity;if(o&&o.isPro)return;const l=(0,r.applyFilters)("kubio.register-variation",s(t),o);e=(0,r.applyFilters)("kubio.register-variation.blockName",e);const{addBlockVariations:c}=(0,i.dispatch)("core/blocks");c(e,l),(0,r.doAction)("kubio.variation-added",e,l,((e,t)=>c(e,(0,n.refreshBlockStyleRefs)(t))))},g=e=>{Array.isArray(e)||(e=[e]),l?l(e):e.forEach((e=>{b.push(e)}))},w=e=>{Array.isArray(e)||(e=[e]),c?c(e):e.forEach((e=>{f.push(e)}))},y=a().debounce((e=>{(()=>{const{updateSettings:e}=(0,i.dispatch)(o.STORE_KEY);l=(0,n.queueCall)((t=>{const n=(0,i.select)(o.STORE_KEY).getSettings(),r=n[u],l=(0,s.flatten)((0,s.flatten)(t));e({...n,[u]:a().uniqBy([...r,...l],"name")})}),500),c=(0,n.queueCall)(((t=[])=>{const n=(0,i.select)(o.STORE_KEY).getSettings(),r=n[d],l=(0,s.flatten)((0,s.flatten)(t));e({...n,[d]:a().uniqBy([...r,...l],"name")})}),500),l(b),c(f),b=[],f=[],window.kubioPatternsRegistered=!0})(),e()}),2e3),h=()=>{const e=(0,i.subscribe)((()=>{const{isResolving:t,getSettings:n}=(0,i.select)(o.STORE_KEY);t&&!t()&&n().kubioLoaded&&y(e)}))},B=window.kubio.adminPanel,S=window.kubio.blockLibrary,T=window.kubio.core,_=window.kubio.pro,O=window.wp.i18n,E=(0,S.getNamesOfBlocks)();let P=["Overlappable","current-template","Hero Accent","About","Features","Content","CTA","Blog","Counters","Portfolio","Photo Gallery","Testimonials","Clients","Team","Contact","F.A.Q.","Pricing","blank","custom","Reusable Sections","Inner Headers","Headers","Footers","Navigation"];const v=["portfolio2 new","portfolio3 new"],C=["footer5"];P=P.concat(P.map(a().toLower));const R={"kubio/section":"content","kubio/header":"header","kubio/footer":"footer"},N=(0,S.getBlocksByName)(),A=e=>a().get(N,e+".settings.title",""),F=e=>A(e),I=e=>A(e)+"(from default preset)",L=(e,t)=>o=>{const{value:i}=o;m(t,(0,n.refreshBlockStyleRefs)({name:t,isDefault:!0,title:F(t),description:I(t),attributes:{},innerBlocks:[i]}));const[,r,s]=i;m(e,(0,n.refreshBlockStyleRefs)({name:e,isDefault:!0,title:F(e),description:I(e),attributes:r,innerBlocks:s}))},G={[E.BUTTON]:L(E.BUTTON,E.BUTTON_GROUP),[E.LINK]:L(E.LINK,E.LINK_GROUP)},K=[E.SECTION,E.HERO,E.NAVIGATION],x=(...e)=>{setTimeout(((e,t)=>{const{value:o}=e;if(a().has(G,t))return G[t](e);m(t,(0,n.refreshBlockStyleRefs)({name:t,isDefault:!0,title:F(t),description:F(t),attributes:o[1],innerBlocks:o[2]}))}),1,...e)};function D(e){const t=a().get(N,e,{}),{template:o}=t;o&&(U(o[0]),m(e,(0,n.refreshBlockStyleRefs)({name:e,isDefault:!0,title:F(e),description:F(e),attributes:{},innerBlocks:o})))}function U(e){const t=a().get(e,"2",[]);t.forEach(((e,o)=>{"function"==typeof e?a().set(t,o,e()):U(e)}))}const $=(e=!1)=>{(0,B.initAdminStore)((async({sections:t,headers:r,footers:l,presets:c})=>{const{defaultsByType:u}=(e=>{const t=a().groupBy(e,"component"),o={};return a().each(t,((e,t)=>{Array.isArray(e)&&e.forEach((e=>{a().get(e,"meta",[]).includes(B.ContentMetas.IS_DEFAULT_PRESET)&&(o[t]=e)}))})),{defaultsByType:o,allByType:t}})(c);if(a().each(u,x),setTimeout((()=>{K.forEach(D)}),200),e)return;let d=[].concat(t,innerHeaders,r,l);d=d.filter((e=>P.includes(e.category.toLowerCase())&&!C.includes(null==e?void 0:e.name)));const b={},f=(0,S.getProBlocks)(),p=d.map((e=>{const t=R[e.component],o=((e,t="content")=>a().toLower(`kubio-${t}/${e}`))(e.category,t);b[e.category]=o;const i=(e.meta||[]).includes(B.ContentMetas.IS_FREE)||v.includes(e.name),r=a().isString(e.value)?JSON.parse(e.value):e.value;let l=!i;i&&(0,s.intersection)((0,n.getBlocksUsedInTemplate)(r),f).length&&(l=!0);const c=(0,_.isFreeVersion)()&&l,u={};null!=e&&e.context&&(u.context=e.context),null!=e&&e.filters&&(u.filters=e.filters);let d=a().get(e,"collections",[]);return d=a().difference(d,["default"]),{name:`${o}/${e.name}/${e.id}`,title:e.name,categories:[o],collections:d,index:null==e?void 0:e.index,description:"Placeholder",screenshot:e.screenshot,fromColibri:!(null==e||!e.fromColibri),fromFirebase:!0,isProOnFree:c,isGutentagPattern:!0,content:r,...u}}));let k=[];a().each(b,((e,t)=>{k.push({label:t,name:e})})),((e,t)=>{const o=a().get(N,E.SECTION,{}),{template:n}=o;if(!n)return;const i=(0,T.composeBlockWithStyle)(E.SECTION,{},n),r="kubio-content/blank",s={label:(0,O.__)("Blank","kubio"),name:r},l={name:`${r}/blank-section`,title:(0,O.__)("Blank section","kubio"),categories:[r],description:(0,O.__)("Blank section","kubio"),screenshot:"https://content.colibriwp.com/screenshots/blank.png",fromColibri:!0,fromFirebase:!0,isProOnFree:!1,isGutentagPattern:!0,content:i};e.push(l),t.push(s)})(p,k),k=(e=>{const t={label:(0,O.__)("Custom sections","kubio"),name:"kubio-content/custom"};return e.push(t),e})(k),w(k),g(p),(0,i.dispatch)(o.SESSION_STORE_KEY).setProp(o.GLOBAL_SESSION_ID,"variations-loaded",!0)}))};var H,M;null!==(H=window)&&void 0!==H&&null!==(M=H.kubioBlockPatterns)&&void 0!==M&&M.inGutenbergEditor&&$(!0),(window.kubio=window.kubio||{}).blockPatterns=t})();
